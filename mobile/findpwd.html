<!DOCTYPE html>
<html>
	<head>
		<title>找回密码</title>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
		<link rel="stylesheet" href="weui/lib/weui.min.css">
		<link rel="stylesheet" href="weui/css/jquery-weui.css">
		<link rel="stylesheet" href="weui/css/demos.css">
		<link rel="stylesheet" href="layui/css/layui.css" media="all">
		<script src="weui/lib/jquery-2.1.4.js"></script>
		<script src="weui/lib/fastclick.js"></script>
		<script src="weui/js/swiper.min.js"></script>
		<script src="weui/js/jquery-weui.js"></script>
		<script type="application/javascript" src="weui/js/include.js"></script>
		<script type="text/javascript" src="weui/js/config.js"></script>
	</head>
	<body ontouchstart>
		<!-- 引入头部 -->
		<div id="header_box"></div>

		<h2 style="margin: 10px 15px;">找回密码</h2>
		<div class="weui-cells weui-cells_form">
			<div class="weui-cell">
				<div class="weui-cell__hd"><label class="weui-label">手机号码</label></div>
				<div class="weui-cell__bd">
					<input class="weui-input" id="acc_phone" type="number" pattern="[0-9]*" placeholder="请输入手机号码">
				</div>
			</div>

			<div class="weui-cell">
				<div class="weui-cell__hd"><label class="weui-label">验证码</label></div>
				<div class="weui-cell__bd">
					<input id="userCode" class="weui-input" type="text" placeholder="请输入验证码">
				</div>
				<div class="weui-cell__ft">
					<input type="button" id="button" onclick="" class="weui-vcode-btn" value="获取验证码" style="background-color: white;border: white;" />
				</div>
			</div>
		</div>

		<div style="margin: 10px 20px ;">
			<a id="btnFind" class="layui-btn layui-btn-lg layui-btn-primary layui-btn-radius" style="background: gold; color: white; width: 100%;">下一步</a>
		</div>

		<!-- 引入尾部 -->
		<div id="footer_box"></div>
	</body>
	<script type="text/javascript">
		$(function() {
			FastClick.attach(document.body);

			//下一步按钮点击事件
			$("#btnFind").click(function() {
				//获取手机号码
				var phone = $("#acc_phone").val();
				//获取验证码
				var userCode = $("#userCode").val();

				//进行判断
				if (!(/^[0-9]{11}$/.test(phone))) {
					$.alert("手机号不正确！", "存不存提示", function() {
						$("#acc_phone").focus();
					});
					return;
				}
				if (userCode == '' || userCode.length != 6) {
					$.alert("验证码错误", "存不存提示", function() {
						$("#userCode").focus();
					});
					return;
				}

				//提交后台
				sendRequest("as.do", {
						"m": "findPwd",
						"phone": phone,
						"userCode": userCode
					},
					function(result) {
						//alert(result.code +"-------"+result.msg);
						//获取返回值，反馈给用户
						//window.alert(result.msg);
						if (result.code != 1) {
							//重置失败
							$.alert(result.msg, "存不存提示");
						} else {
							//重置成功
							$.alert("重置成功！默认密码为666666", "存不存提示", function() {
								//跳转到登录
								window.location.href = 'login.html';
							});
						}
					})
			});
			//发送验证码按钮事件
			$("#button").click(function(){
				//alert(12345);
				//向后台发送验证码
				//获取手机号码
				var phone = $("#acc_phone").val();
				var regex = /^1\d{10}$/;
				if (phone.length == 0) {
					$.alert("手机号不能为空", "存不存提示", function() {
						$("#acc_phone").focus();
					});
					return;
				} else if (!regex.exec(phone)) {
					$.alert("手机号不正确！", "存不存提示", function() {
						$("#acc_phone").focus();
					});
					return;
				} else {
					//向输入的手机号码发送短信验证码
					sendRequest("as.do", {
							"m": "sendMsg",
							"phone": phone
						},
						function(result) {
							//alert(result.code +"-------"+result.msg);
							//获取返回值，反馈给用户
							if (result.code == 1 || result.code == 2) { //发送失败
								$.alert(result.msg, "警告！");
							} else {
								$.alert("发送成功", "存不存提示",settime());
							}
						})
					//阻止表单提交 阻止页面刷新
					return false;
				}
			});
		});
		
		<!--倒计时函数实现-->
		var countdown = 60;
		
		function settime() {
			var obj = document.getElementById('button');
			if (countdown == 0) {
				obj.removeAttribute("disabled");
				obj.value = "获取验证码";
				countdown = 60;
				return;
			} else {
				obj.setAttribute("disabled", true);
				obj.value = "重新发送(" + countdown + ")";
				countdown--;
			}
			setTimeout(function() {
				settime()
			}, 1000)
		}
	</script>
</html>
